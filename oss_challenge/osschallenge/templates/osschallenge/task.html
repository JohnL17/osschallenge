{% extends 'osschallenge/index.html' %}
{% load i18n %}
{% load django_markdown %}

{% block content %}
{% load staticfiles %}
<div class="grid content page-content--scroll">
    <div class="grid-cell grid-cell--2of12">
        <div class="example-grid-content">
            {% if task.fileurl == "/media/file" %}
            <p>No image</p>
            {% elif task.fileurl == "/media/" %}
            <p>No image</p>
            {% else %}
            <a href="{{ task.fileurl }}">
                <img class="img-responsive" src="{{ task.picture.avatar.url }}">
            </a>
            {% endif %}
        </div>
    </div>
    <div class="grid-cell grid-cell--10of12">
        <div class="example-grid-content">
            <div class="detail">
                <h1 class="tasktitle">{{ task.title }}
                   {% if task.task_done == True %}
                   </br>{% trans "done" %} {% trans "by" %} {{ task.assignee }}
                   {% elif task.assignee_id != NULL %}
                   </br>{% trans "claimed" %} {% trans "by" %} {{ task.assignee }}
                   {% else %}
                   {% endif %}
                </h1>
                {% if error_message %}<p><strong>{% trans error_message %}</strong></p>{% endif %}
                <p>{% trans task.lead_text %}</p>
                <p><strong>{% trans "Description" %}</strong><br>{% trans task.description %}</p>
                <h3>{% trans "Contact:" %}</h3>
                <p>{{ task.mentor.username }}
                <br>{{ task.mentor.first_name }} {{ task.mentor.last_name }}
                <br>{{ task.mentor.email }}
                </p>
                {% if user.profile.role.id == mentor_id %}
                <a href="edit/" class=" btn btn-primary">{% trans "Edit" %}</a>
                </br>
                {% elif task.assignee_id == NULL %}
                    <form action="" method="POST" class="edit">
                        {% csrf_token %}
                        <button class="btn btn-primary" name="Claim">{% trans "Claim" %}</button>
                    </form>
                {% elif task.assignee_id == user.id and task.task_done == False %}
                    <form action="" method="POST" class="edit">
                        {% csrf_token %}
                        <button class="btn btn-primary" name={% trans "Release" %}>{% trans "Release" %}</button>
                    </form>
                {% endif %}
                {% if task.task_done == False and task.assignee_id == user.id %}
                    <form action="" method="POST" class="edit">
                        {% csrf_token %}
                        <button class="btn btn-primary" name="Task done">{% trans "Task done" %}</button>
                    </form>
                {% else %}
                {% endif %}
                </br>
                <h3>Enter a comment</h3> 
                <form method="POST">
                    <textarea rows="4" class="textarea" name="comment" placeholder="Enter text here..."></textarea>
                    {% csrf_token %}
                    <strong><p class="markdown">{% trans "Markdown available" %}</p></strong>
                    <button class="btn btn-primary" name="Comment">{% trans "Comment" %}</button>
                </br>
                </br>
                </form>
                {% for comment in comment_list %}
                {% if comment.task_id == task.id %}
                <div class="card--inverse card--primary comment">
                    <div class="comment-title card-header">
                        {% if comment.author.id == mentor_id %}
                            <b>{{ comment.author.first_name }} {{comment.author.last_name}} </b>
                            <i class="fa fa-star" aria-hidden="true"></i>
                        {% else %}
                            <b>{{ comment.author.username }}</b>
                        {% endif %}
                    </div>
                    <div class="card-block">
                        {{ comment.comment|markdown|linebreaks }}
                        <footer class="text-right">
                            {{ comment.created_at|date:'Y-m-d, H:i' }}
                        </footer>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock content %}

